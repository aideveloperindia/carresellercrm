"use strict";(()=>{var e={};e.id=814,e.ids=[814],e.modules={2934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2781:e=>{e.exports=require("stream")},3837:e=>{e.exports=require("util")},92:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>f,originalPathname:()=>g,patchFetch:()=>x,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h,staticGenerationBailout:()=>w});var a={};t.r(a),t.d(a,{POST:()=>d});var n=t(2390),s=t(1498),i=t(9308),o=t(7024),u=t(4099),c=t(1710);async function d(e){try{let r=await (0,c.fM)();if(!r)return o.Z.json({error:"Unauthorized"},{status:401});let{oldPassword:t,newPassword:a}=await e.json();if(!t||!a)return o.Z.json({error:"Old password and new password are required"},{status:400});if(a.length<6)return o.Z.json({error:"New password must be at least 6 characters"},{status:400});let n=await u._.admin.findUnique({where:{id:r.id}});if(!n)return o.Z.json({error:"Admin not found"},{status:404});if(!await (0,c.Oe)(t,n.passwordHash))return o.Z.json({error:"Old password is incorrect"},{status:401});let s=await (0,c.c_)(a);await u._.admin.update({where:{id:r.id},data:{passwordHash:s}});let i=(0,c.fT)({adminId:r.id,email:r.email}),d=o.Z.json({success:!0});return d.headers.set("Set-Cookie",(0,c.y$)(i)),d}catch(e){return console.error("Change password error:",e),o.Z.json({error:"Internal server error"},{status:500})}}let l=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/auth/change-password/route",pathname:"/api/auth/change-password",filename:"route",bundlePath:"app/api/auth/change-password/route"},resolvedPagePath:"/Users/nandagiriaditya/Documents/carresellercrm/apps/web/app/api/auth/change-password/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:h,serverHooks:m,headerHooks:f,staticGenerationBailout:w}=l,g="/api/auth/change-password/route";function x(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},1710:(e,r,t)=>{t.d(r,{Oe:()=>l,Rf:()=>f,WX:()=>h,c_:()=>d,fM:()=>w,fT:()=>p,y$:()=>m});var a=t(7882),n=t.n(a),s=t(9814),i=t.n(s),o=t(822);let u=process.env.JWT_SECRET||"change-me-in-production",c="crcrm_session";async function d(e){return n().hash(e,10)}async function l(e,r){return n().compare(e,r)}function p(e){return i().sign(e,u,{expiresIn:"8h"})}function h(e){try{return i().verify(e,u)}catch(e){return null}}function m(e){return[`${c}=${e}`,"Max-Age=28800","Path=/","Secure","SameSite=Strict","HttpOnly"].filter(Boolean).join("; ")}function f(){return[`${c}=`,"Max-Age=0","Path=/","Secure","SameSite=Strict","HttpOnly"].filter(Boolean).join("; ")}async function w(){let e=(0,o.cookies)(),r=e.get(c)?.value;if(!r)return null;let t=h(r);return t?{id:t.adminId,email:t.email}:null}},4099:(e,r,t)=>{t.d(r,{_:()=>n});let a=require("@prisma/client"),n=globalThis.prisma??new a.PrismaClient({log:["error"]})}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[975,683,587],()=>t(92));module.exports=a})();